<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

        <title>reveal.js</title>

        <link rel="stylesheet" href="css/reset.css">
        <link rel="stylesheet" href="css/reveal.css">
        <link rel="stylesheet" href="css/theme/globant.css">

        <!-- Theme used for syntax highlighting of code -->
        <link rel="stylesheet" href="lib/css/monokai.css">
    </head>
    <body>
        <div class="reveal">
            <div class="slides">
                <section>
                    <h2>Building an Emulator with WebAssembly and Rust</h2>
                    <gamebuino-emulator src="https://raw.githubusercontent.com/Rodot/Games-META/master/binaries/METAtris/METAtris.bin">
                    </gamebuino-emulator>
                </section>

                <section>

                    <h2>Rust</h2>
                    <pre><code data-trim data-line-numbers>
            fn execute_instruction(&mut self, 
              instruction: Instruction) {
              match instruction {
                Instruction::LslImm { rs, rd, offset } => {
                  let original = self.read_register(rs);
                  let result = original << offset;
                  self.set_register(rd, result);
                  self.cond_reg.c = original & (1 << offset) != 0;
                  self.set_nz(result);
                }
                    </code></pre>
                </section>

                <section>
                    <pre><code data-trim data-line-numbers>
                        (module
                          (func (export "add") (param $lhs i32) (param $rhs i32)
                            (result i32)
                            (i32.add
                              (local.get $lhs)
                              (local.get $rhs)
                            )
                          )
                        )
                    </code></pre>
                </section>

                <section>
                    <pre><code data-trim data-line-numbers="|7-9|10">
                        &#x3C;!DOCTYPE html&#x3E;
                        &#x3C;html&#x3E;
                        &#x3C;head&#x3E; &hellip; &#x3C;/head&#x3E;
                        &#x3C;body&#x3E;
                          &#x3C;script&#x3E;
                            (async function() {
                              let obj = await WebAssembly.instantiateStreaming(
                                fetch("add.wasm")
                              );
                              console.log(obj.instance.exports.add(1, 2)); // 3
                            })();
                          &#x3C;/script&#x3E;
                        &#x3C;/body&#x3E;
                        &#x3C;/html&#x3E;
                    </code></pre>
                </section>
                
                <section>
                    <pre style="font-size: 0.4em;"><code data-trim data-line-numbers="|17-20" style="max-height: 600px;">
                    (module
                        (import "js" "mem" (memory 1))
                        (data (i32.const 0) "HAL")
                        (func (export "doSomething")
                            (local $i i32)
                            (loop $loop
                                (i32.store8 
                                    (local.get $i)
                                    (i32.add
                                        (i32.load8_u
                                            (local.get $i)
                                        )
                                        (i32.const 1)
                                    )
                                )
                                (local.set $i
                                    (i32.add
                                        (i32.const 1)
                                        (local.get $i)
                                    )
                                )
                                (br_if $loop
                                    (i32.lt_u
                                        (local.get $i)
                                        (i32.const 3)
                                    )
                                )
                            )
                        )
                    )
                    </code></pre>
                </section>
                <section>
                    <iframe class="stretch" data-src="wasm.html"></iframe>
                </section>
                <section>
                    <h2>Links</h2>
                    <ul>
                        <li><a href="https://github.com/aoneill01/wasm-gamebuino">github.com/aoneill01/wasm-gamebuino</a></li>
                        <li><a href="https://gamebuino.com/">gamebuino.com</a></li>
                        <li><a href="https://rustwasm.github.io/docs/book/">rustwasm.github.io/docs/book/</a></li>
                    </ul>
                </section>
            </div>
        </div>

        <script src="js/reveal.js"></script>

        <script>
            // More info about config & dependencies:
            // - https://github.com/hakimel/reveal.js#configuration
            // - https://github.com/hakimel/reveal.js#dependencies
            Reveal.initialize({
                hash: true,
                dependencies: [
                    { src: 'plugin/markdown/marked.js' },
                    { src: 'plugin/markdown/markdown.js' },
                    { src: 'plugin/highlight/highlight.js' },
                    { src: 'plugin/notes/notes.js', async: true }
                ]
            });
        </script>
        <script src="https://unpkg.com/@aoneill01/wasm-gamebuino" type="module"></script>
    </body>
</html>
